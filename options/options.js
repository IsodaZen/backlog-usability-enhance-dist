var ne=Object.defineProperty;var ae=(y,g,x)=>g in y?ne(y,g,{enumerable:!0,configurable:!0,writable:!0,value:x}):y[g]=x;var I=(y,g,x)=>ae(y,typeof g!="symbol"?g+"":g,x);(function(){"use strict";var y=document.createElement("style");y.textContent=`:root{--font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;--text-primary: #333;--text-secondary: #666;--bg-primary: #ffffff;--bg-secondary: #f8f9fa;--bg-tertiary: #f5f5f5;--border-color: #e9ecef;--border-radius: 4px;--border-radius-lg: 8px;--spacing-sm: 4px;--spacing-md: 8px;--spacing-lg: 12px;--spacing-xl: 16px;--spacing-xxl: 24px;--shadow: 0 2px 4px rgba(0, 0, 0, .1);--primary-color: #007bff;--primary-hover: #0056b3;--secondary-color: #6c757d;--secondary-hover: #545b62;--success-color: #28a745;--transition-base: .2s ease}@media (prefers-color-scheme: dark){:root{--text-primary: #e4e4e7;--text-secondary: #a1a1aa;--bg-primary: #2a2a2a;--bg-secondary: #1a1a1a;--bg-tertiary: #404040;--border-color: #404040;--primary-color: #60a5fa;--primary-hover: #3b82f6}}body{font-family:var(--font-family);max-width:600px;margin:0 auto;padding:var(--spacing-xxl);background-color:var(--bg-tertiary);color:var(--text-primary)}.header{text-align:center;margin-bottom:30px;background:var(--bg-primary);padding:var(--spacing-xxl);border-radius:var(--border-radius-lg);box-shadow:var(--shadow)}.header h1{margin:0 0 var(--spacing-lg) 0;color:var(--text-primary)}.header p{margin:0;color:var(--text-secondary);font-size:14px}.section{background:var(--bg-primary);margin-bottom:var(--spacing-xxl);border-radius:var(--border-radius-lg);box-shadow:var(--shadow)}.section-header{padding:var(--spacing-xl) var(--spacing-xxl);border-bottom:1px solid var(--border-color);background:var(--bg-secondary);border-radius:var(--border-radius-lg) var(--border-radius-lg) 0 0}.section-header h2{margin:0;font-size:16px;color:var(--text-primary)}.section-content{padding:var(--spacing-xxl)}.setting-item{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:var(--spacing-xl);padding-bottom:var(--spacing-xl);border-bottom:1px solid var(--border-color)}.setting-item:last-child{margin-bottom:0;padding-bottom:0;border-bottom:none}.setting-info{flex:1;margin-right:var(--spacing-xxl)}.setting-title{font-weight:500;margin-bottom:var(--spacing-sm);color:var(--text-primary)}.setting-description{font-size:13px;color:var(--text-secondary);line-height:1.4}.setting-control{flex-shrink:0}.toggle{position:relative;display:inline-block;width:50px;height:26px}.toggle input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:var(--border-color);transition:var(--transition-base);border-radius:26px}.slider:before{position:absolute;content:"";height:20px;width:20px;left:3px;bottom:3px;background-color:var(--bg-primary);transition:var(--transition-base);border-radius:50%}input:checked+.slider{background-color:var(--success-color)}input:checked+.slider:before{transform:translate(24px)}input:focus+.slider{box-shadow:0 0 0 2px #28a7454d}.sub-setting{margin-left:var(--spacing-xxl);margin-top:var(--spacing-lg);padding-left:var(--spacing-xxl);border-left:2px solid var(--border-color)}.status{text-align:center;padding:10px;margin-top:20px;border-radius:4px;font-size:14px;display:none}.status.success{background-color:#d4edda;color:#155724;border:1px solid #c3e6cb}.status.error{background-color:#f8d7da;color:#721c24;border:1px solid #f5c6cb}.actions{text-align:center;margin-top:30px}.btn{background:var(--primary-color);color:#fff;border:none;padding:var(--spacing-lg) var(--spacing-xxl);border-radius:var(--border-radius);cursor:pointer;font-size:14px;margin:0 var(--spacing-sm);transition:var(--transition-base)}.btn:hover{background:var(--primary-hover)}.btn:focus{outline:2px solid var(--primary-color);outline-offset:2px}.btn.secondary{background:var(--secondary-color)}.btn.secondary:hover{background:var(--secondary-hover)}.btn-sm{padding:4px 8px;font-size:12px;height:fit-content}.pr-format-setting{flex-direction:column;align-items:stretch}.pr-format-setting .setting-info{margin-right:0;margin-bottom:var(--spacing-lg)}.pr-format-management{width:100%}.project-add-area{display:flex;gap:var(--spacing-md);margin-bottom:var(--spacing-xl);align-items:center}.project-input{flex:1;padding:var(--spacing-md);border:1px solid var(--border-color);border-radius:var(--border-radius);font-size:12px;background:var(--bg-primary);color:var(--text-primary)}.project-input:focus{outline:2px solid var(--primary-color);outline-offset:1px;border-color:var(--primary-color)}.project-list{max-height:300px;overflow-y:auto}.project-item{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md) var(--spacing-lg);border:1px solid var(--border-color);border-radius:var(--border-radius);margin-bottom:var(--spacing-md);background:var(--bg-secondary);transition:var(--transition-base)}.project-item:hover{background:var(--bg-tertiary)}.project-item.editing{flex-direction:column;align-items:stretch;background:var(--bg-primary);border-color:var(--primary-color)}.project-name{font-weight:500;color:var(--text-primary)}.project-actions{display:flex;gap:var(--spacing-md)}.template-editor{margin-top:var(--spacing-xl);width:100%}.template-textarea{width:100%;box-sizing:border-box;min-height:150px;padding:var(--spacing-lg);border:1px solid var(--border-color);border-radius:var(--border-radius);font-family:Courier New,monospace;font-size:13px;resize:vertical;background:var(--bg-primary);color:var(--text-primary);line-height:1.5}.template-textarea:focus{outline:2px solid var(--primary-color);outline-offset:1px;border-color:var(--primary-color)}.editor-actions{display:flex;gap:var(--spacing-md);margin-top:var(--spacing-lg);justify-content:flex-end}.btn-danger{background:#dc3545;color:#fff}.btn-danger:hover{background:#c82333}@media (max-width: 768px){.project-actions{flex-direction:column;gap:4px}.template-textarea{min-height:120px}.project-add-area{flex-direction:column}}
/*$vite$:1*/`,document.head.appendChild(y);const g={boardAccordion:{enabled:!0},shortcutKeys:{enabled:!0},issuePending:{enabled:!0,autoResolve:!0},prFormat:{enabled:!0,projectTemplates:{}}};var x=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function G(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var K={exports:{}};(function(r){(function(e,t){r.exports?r.exports=t():e.log=t()})(x,function(){var e=function(){},t="undefined",o=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"],i={},d=null;function E(s,u){var n=s[u];if(typeof n.bind=="function")return n.bind(s);try{return Function.prototype.bind.call(n,s)}catch{return function(){return Function.prototype.apply.apply(n,[s,arguments])}}}function j(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function F(s){return s==="debug"&&(s="log"),typeof console===t?!1:s==="trace"&&o?j:console[s]!==void 0?E(console,s):console.log!==void 0?E(console,"log"):e}function v(){for(var s=this.getLevel(),u=0;u<a.length;u++){var n=a[u];this[n]=u<s?e:this.methodFactory(n,s,this.name)}if(this.log=this.debug,typeof console===t&&s<this.levels.SILENT)return"No console available for logging"}function _(s){return function(){typeof console!==t&&(v.call(this),this[s].apply(this,arguments))}}function M(s,u,n){return F(s)||_.apply(this,arguments)}function T(s,u){var n=this,A,$,L,b="loglevel";typeof s=="string"?b+=":"+s:typeof s=="symbol"&&(b=void 0);function te(c){var p=(a[c]||"silent").toUpperCase();if(!(typeof window===t||!b)){try{window.localStorage[b]=p;return}catch{}try{window.document.cookie=encodeURIComponent(b)+"="+p+";"}catch{}}}function z(){var c;if(!(typeof window===t||!b)){try{c=window.localStorage[b]}catch{}if(typeof c===t)try{var p=window.document.cookie,B=encodeURIComponent(b),D=p.indexOf(B+"=");D!==-1&&(c=/^([^;]+)/.exec(p.slice(D+B.length+1))[1])}catch{}return n.levels[c]===void 0&&(c=void 0),c}}function re(){if(!(typeof window===t||!b)){try{window.localStorage.removeItem(b)}catch{}try{window.document.cookie=encodeURIComponent(b)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function k(c){var p=c;if(typeof p=="string"&&n.levels[p.toUpperCase()]!==void 0&&(p=n.levels[p.toUpperCase()]),typeof p=="number"&&p>=0&&p<=n.levels.SILENT)return p;throw new TypeError("log.setLevel() called with invalid level: "+c)}n.name=s,n.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},n.methodFactory=u||M,n.getLevel=function(){return L??$??A},n.setLevel=function(c,p){return L=k(c),p!==!1&&te(L),v.call(n)},n.setDefaultLevel=function(c){$=k(c),z()||n.setLevel(c,!1)},n.resetLevel=function(){L=null,re(),v.call(n)},n.enableAll=function(c){n.setLevel(n.levels.TRACE,c)},n.disableAll=function(c){n.setLevel(n.levels.SILENT,c)},n.rebuild=function(){if(d!==n&&(A=k(d.getLevel())),v.call(n),d===n)for(var c in i)i[c].rebuild()},A=k(d?d.getLevel():"WARN");var O=z();O!=null&&(L=k(O)),v.call(n)}d=new T,d.getLogger=function(u){if(typeof u!="symbol"&&typeof u!="string"||u==="")throw new TypeError("You must supply a name when creating a logger.");var n=i[u];return n||(n=i[u]=new T(u,d.methodFactory)),n};var U=typeof window!==t?window.log:void 0;return d.noConflict=function(){return typeof window!==t&&window.log===d&&(window.log=U),d},d.getLoggers=function(){return i},d.default=d,d})})(K);var Y=K.exports;const f=G(Y),N={level:"info",prefix:"[Backlog Enhancement]",timestamp:!0},w={boardAccordion:"error",issuePending:"error",shortcutKeys:"error",storage:"error",backlog:"error",background:"error",options:"error",content:"error"},R=new Map;function W(r){f.setLevel(r)}function P(r,e){const t=R.get(r);t&&t.setLevel(e),w[r]=e}function H(r){return w[r]||"info"}function q(){return{...w}}function V(r){const e=R.get(r);if(e)return e;const t=f.getLogger(r),o=w[r]||"info";t.setLevel(o);const a=t.methodFactory;return t.methodFactory=function(i,d,E){const j=a(i,d,E);return function(...F){const v=`[${new Date().toISOString()}]`,_=`${N.prefix}`,M=`[${i.toUpperCase()}]`,T=`[${r.charAt(0).toUpperCase()+r.slice(1)}]`,U=[`${v} ${_} ${M} ${T}`,...F].filter(Boolean);j(...U)}},t.setLevel(t.getLevel()),R.set(r,t),t}function C(){if(typeof window>"u"||typeof chrome>"u")return!0;try{return window.location.hostname==="localhost"||window.location.hostname.includes("dev")||chrome.runtime.getManifest().version.includes("dev")}catch{return!0}}function J(r){const e=f.methodFactory;f.methodFactory=function(t,o,a){const i=e(t,o,a);return function(...d){const E=r.timestamp?`[${new Date().toISOString()}]`:"",j=r.prefix?`${r.prefix}`:"",F=`[${t.toUpperCase()}]`,v=[`${E} ${j} ${F}`,...d].filter(Boolean);i(...v)}},f.setLevel(f.getLevel())}function Q(r){const e={...N,...r};C()?e.level="debug":e.level="warn",J(e),W(e.level),f.info("Logger initialized",{level:e.level,isDev:C()})}function h(r){const e=V(r);return{debug:(...t)=>e.debug(...t),info:(...t)=>e.info(...t),warn:(...t)=>e.warn(...t),error:(...t)=>e.error(...t)}}const l={debug:(...r)=>f.debug(...r),info:(...r)=>f.info(...r),warn:(...r)=>f.warn(...r),error:(...r)=>f.error(...r),boardAccordion:h("boardAccordion"),issuePending:h("issuePending"),shortcutKeys:h("shortcutKeys"),storage:h("storage"),backlog:h("backlog"),background:h("background"),options:h("options"),content:h("content"),popup:h("popup")},X={setLevel:P,getLevel:H,showAll:()=>{console.table(q())},enable:r=>{P(r,"debug"),console.log(`✅ ${r} logging enabled (debug level)`)},disable:r=>{P(r,"silent"),console.log(`❌ ${r} logging disabled`)},enableAll:()=>{Object.keys(w).forEach(r=>{P(r,"debug")}),console.log("✅ All feature logging enabled")},disableAll:()=>{Object.keys(w).forEach(r=>{P(r,"error")}),console.log("❌ All feature logging disabled (error only)")}};typeof window<"u"&&C()&&(window.__backlogLoggerControl__=X),Q();class m{static async getSettings(){try{const t=(await chrome.storage.sync.get(this.SETTINGS_KEY))[this.SETTINGS_KEY];return t?this.mergeWithDefaults(t):g}catch(e){return l.storage.error("Failed to get settings:",e),g}}static async saveSettings(e){try{await chrome.storage.sync.set({[this.SETTINGS_KEY]:e})}catch(t){throw l.storage.error("Failed to save settings:",t),t}}static onSettingsChanged(e){chrome.storage.onChanged.addListener((t,o)=>{if(o==="sync"&&t[this.SETTINGS_KEY]){const a=t[this.SETTINGS_KEY].newValue;a&&e(this.mergeWithDefaults(a))}})}static mergeWithDefaults(e){return{boardAccordion:{...g.boardAccordion,...e.boardAccordion},shortcutKeys:{...g.shortcutKeys,...e.shortcutKeys},issuePending:{...g.issuePending,...e.issuePending},prFormat:{...g.prFormat,...e.prFormat}}}}I(m,"SETTINGS_KEY","backlog_usability_enhance_settings");class S{static async getProjectTemplate(e){try{return(await m.getSettings()).prFormat.projectTemplates[e]||null}catch(t){return l.storage.error("Failed to get project template:",{projectKey:e,error:t}),null}}static async setProjectTemplate(e,t){try{const o=await m.getSettings();o.prFormat.projectTemplates[e]=t,await m.saveSettings(o),l.storage.info("Project template saved:",{projectKey:e})}catch(o){throw l.storage.error("Failed to save project template:",{projectKey:e,error:o}),o}}static async removeProjectTemplate(e){try{const t=await m.getSettings();delete t.prFormat.projectTemplates[e],await m.saveSettings(t),l.storage.info("Project template removed:",{projectKey:e})}catch(t){throw l.storage.error("Failed to remove project template:",{projectKey:e,error:t}),t}}static async getAllProjectTemplates(){try{return(await m.getSettings()).prFormat.projectTemplates}catch(e){return l.storage.error("Failed to get all project templates:",e),{}}}static async isEnabled(){try{return(await m.getSettings()).prFormat.enabled}catch(e){return l.storage.error("Failed to get PR format enabled status:",e),!1}}static async setEnabled(e){try{const t=await m.getSettings();t.prFormat.enabled=e,await m.saveSettings(t),l.storage.info("PR format enabled status updated:",{enabled:e})}catch(t){throw l.storage.error("Failed to update PR format enabled status:",{enabled:e,error:t}),t}}}class Z{constructor(e){I(this,"container");I(this,"editingProjectKey",null);this.container=e,this.init()}async init(){await this.loadAndRenderProjects(),this.setupEventListeners()}setupEventListeners(){const e=document.getElementById("addProjectBtn"),t=document.getElementById("newProjectName");e&&e.addEventListener("click",this.handleAddProject.bind(this)),t&&t.addEventListener("keypress",a=>{a.key==="Enter"&&this.handleAddProject()});const o=document.getElementById("projectList");o&&o.addEventListener("click",this.handleProjectActions.bind(this))}async loadAndRenderProjects(){try{const e=await S.getAllProjectTemplates(),t=document.getElementById("projectList");if(!t)return;if(t.innerHTML="",Object.keys(e).length===0){t.innerHTML='<div style="text-align: center; color: var(--text-secondary); padding: 1rem;">まだプロジェクトが登録されていません</div>';return}Object.entries(e).forEach(([o,a])=>{const i=this.createProjectItem(o,a);t.appendChild(i)})}catch(e){l.error("Failed to load projects:",e)}}createProjectItem(e,t){const o=document.createElement("div");return o.className="project-item",o.dataset.projectKey=e,this.editingProjectKey===e?(o.className+=" editing",o.innerHTML=`
        <span class="project-name">${e} （編集中）</span>
        <div class="template-editor">
          <textarea class="template-textarea" placeholder="テンプレート内容を入力してください...">${t}</textarea>
          <div class="editor-actions">
            <button type="button" class="btn btn-sm" data-action="save">保存</button>
            <button type="button" class="btn btn-sm secondary" data-action="cancel">キャンセル</button>
          </div>
        </div>
      `):o.innerHTML=`
        <span class="project-name">${e}</span>
        <div class="project-actions">
          <button type="button" class="btn btn-sm secondary" data-action="edit">編集</button>
          <button type="button" class="btn btn-sm btn-danger" data-action="delete">削除</button>
        </div>
      `,o}async handleAddProject(){try{const e=document.getElementById("newProjectName"),t=e.value.trim();if(!t){this.showError("プロジェクト名を入力してください");return}if(await S.getProjectTemplate(t)!==null){this.showError("このプロジェクトは既に登録されています");return}await S.setProjectTemplate(t,""),e.value="",await this.loadAndRenderProjects(),this.showSuccess("プロジェクトを追加しました")}catch(e){l.error("Failed to add project:",e),this.showError("プロジェクトの追加に失敗しました")}}async handleProjectActions(e){const t=e.target;if(!t.matches("[data-action]"))return;const o=t.dataset.action,a=t.closest(".project-item"),i=a==null?void 0:a.dataset.projectKey;if(i)try{switch(o){case"edit":await this.startEditing(i);break;case"delete":await this.deleteProject(i);break;case"save":await this.saveTemplate(i,a);break;case"cancel":await this.cancelEditing();break}}catch(d){l.error("Project action failed:",{action:o,projectKey:i,error:d}),this.showError("操作に失敗しました")}}async startEditing(e){this.editingProjectKey=e,await this.loadAndRenderProjects()}async deleteProject(e){confirm(`プロジェクト "${e}" を削除しますか？`)&&(await S.removeProjectTemplate(e),await this.loadAndRenderProjects(),this.showSuccess("プロジェクトを削除しました"))}async saveTemplate(e,t){const a=t.querySelector(".template-textarea").value;await S.setProjectTemplate(e,a),this.editingProjectKey=null,await this.loadAndRenderProjects(),this.showSuccess("テンプレートを保存しました")}async cancelEditing(){this.editingProjectKey=null,await this.loadAndRenderProjects()}showError(e){this.showMessage(e,"error")}showSuccess(e){this.showMessage(e,"success")}showMessage(e,t){let o=document.querySelector(".status");o||(o=document.createElement("div"),o.className="status",this.container.appendChild(o)),o.textContent=e,o.className=`status ${t}`,o.style.display="block",setTimeout(()=>{o.style.display="none"},3e3)}}class ee{constructor(){I(this,"settings",g);this.init()}async init(){try{await this.loadSettings(),this.updateUI(),this.setupEventListeners(),this.initializePrFormatUI(),l.info("Options page initialized")}catch(e){l.error("Failed to initialize options page:",e)}}initializePrFormatUI(){const e=document.getElementById("prFormatManagement");e&&new Z(e)}async loadSettings(){this.settings=await m.getSettings(),l.debug("Settings loaded:",this.settings)}updateUI(){const e=document.getElementById("boardAccordionEnabled");e&&(e.checked=this.settings.boardAccordion.enabled);const t=document.getElementById("shortcutKeysEnabled");t&&(t.checked=this.settings.shortcutKeys.enabled);const o=document.getElementById("issuePendingEnabled"),a=document.getElementById("issuePendingAutoResolve");o&&(o.checked=this.settings.issuePending.enabled),a&&(a.checked=this.settings.issuePending.autoResolve);const i=document.getElementById("prFormatEnabled");i&&(i.checked=this.settings.prFormat.enabled),this.updateSubSettingsState()}updateSubSettingsState(){const e=document.getElementById("issuePendingEnabled"),t=document.getElementById("issuePendingAutoResolve");e&&t&&t.parentElement&&(t.disabled=!e.checked,t.parentElement.style.opacity=e.checked?"1":"0.5");const o=document.getElementById("prFormatEnabled"),a=document.getElementById("prFormatManagement");if(o&&a){const i=!o.checked;a.style.opacity=i?"0.5":"1",a.style.pointerEvents=i?"none":"auto"}}setupEventListeners(){const e=document.getElementById("resetButton");e&&e.addEventListener("click",()=>this.resetSettings()),document.querySelectorAll('input[type="checkbox"]').forEach(o=>{o.addEventListener("change",()=>{this.onSettingChanged(),this.updateSubSettingsState()})})}async onSettingChanged(){await this.updateSettingsFromUI(),await this.saveSettingsImmediate()}async updateSettingsFromUI(){const e=document.getElementById("boardAccordionEnabled");e&&(this.settings.boardAccordion.enabled=e.checked);const t=document.getElementById("shortcutKeysEnabled");t&&(this.settings.shortcutKeys.enabled=t.checked);const o=document.getElementById("issuePendingEnabled"),a=document.getElementById("issuePendingAutoResolve");o&&(this.settings.issuePending.enabled=o.checked),a&&(this.settings.issuePending.autoResolve=a.checked);const i=document.getElementById("prFormatEnabled");i&&(this.settings.prFormat.enabled=i.checked)}async saveSettingsImmediate(){try{await m.saveSettings(this.settings),l.info("Settings saved immediately:",this.settings)}catch(e){l.error("Failed to save settings immediately:",e)}}async resetSettings(){try{if(!confirm("設定をデフォルトに戻しますか？"))return;this.settings={...g},this.updateUI(),await m.saveSettings(this.settings),l.info("Settings reset to default")}catch(e){l.error("Failed to reset settings:",e)}}}document.addEventListener("DOMContentLoaded",()=>{new ee})})();
