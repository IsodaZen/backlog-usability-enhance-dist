var te=Object.defineProperty;var ne=(g,p,w)=>p in g?te(g,p,{enumerable:!0,configurable:!0,writable:!0,value:w}):g[p]=w;var x=(g,p,w)=>ne(g,typeof p!="symbol"?p+"":p,w);(function(){"use strict";const g={boardAccordion:{enabled:!0},shortcutKeys:{enabled:!0},issuePending:{enabled:!0,autoResolve:!0}};var p=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function w(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var O={exports:{}};(function(n){(function(t,e){n.exports?n.exports=e():t.log=e()})(p,function(){var t=function(){},e="undefined",d=typeof window!==e&&typeof window.navigator!==e&&/Trident\/|MSIE /.test(window.navigator.userAgent),l=["trace","debug","info","warn","error"],h={},i=null;function L(s,c){var o=s[c];if(typeof o.bind=="function")return o.bind(s);try{return Function.prototype.bind.call(o,s)}catch{return function(){return Function.prototype.apply.apply(o,[s,arguments])}}}function I(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function A(s){return s==="debug"&&(s="log"),typeof console===e?!1:s==="trace"&&d?I:console[s]!==void 0?L(console,s):console.log!==void 0?L(console,"log"):t}function b(){for(var s=this.getLevel(),c=0;c<l.length;c++){var o=l[c];this[o]=c<s?t:this.methodFactory(o,s,this.name)}if(this.log=this.debug,typeof console===e&&s<this.levels.SILENT)return"No console available for logging"}function R(s){return function(){typeof console!==e&&(b.call(this),this[s].apply(this,arguments))}}function U(s,c,o){return A(s)||R.apply(this,arguments)}function T(s,c){var o=this,k,$,E,f="loglevel";typeof s=="string"?f+=":"+s:typeof s=="symbol"&&(f=void 0);function X(r){var a=(l[r]||"silent").toUpperCase();if(!(typeof window===e||!f)){try{window.localStorage[f]=a;return}catch{}try{window.document.cookie=encodeURIComponent(f)+"="+a+";"}catch{}}}function M(){var r;if(!(typeof window===e||!f)){try{r=window.localStorage[f]}catch{}if(typeof r===e)try{var a=window.document.cookie,C=encodeURIComponent(f),N=a.indexOf(C+"=");N!==-1&&(r=/^([^;]+)/.exec(a.slice(N+C.length+1))[1])}catch{}return o.levels[r]===void 0&&(r=void 0),r}}function Z(){if(!(typeof window===e||!f)){try{window.localStorage.removeItem(f)}catch{}try{window.document.cookie=encodeURIComponent(f)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function F(r){var a=r;if(typeof a=="string"&&o.levels[a.toUpperCase()]!==void 0&&(a=o.levels[a.toUpperCase()]),typeof a=="number"&&a>=0&&a<=o.levels.SILENT)return a;throw new TypeError("log.setLevel() called with invalid level: "+r)}o.name=s,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=c||U,o.getLevel=function(){return E??$??k},o.setLevel=function(r,a){return E=F(r),a!==!1&&X(E),b.call(o)},o.setDefaultLevel=function(r){$=F(r),M()||o.setLevel(r,!1)},o.resetLevel=function(){E=null,Z(),b.call(o)},o.enableAll=function(r){o.setLevel(o.levels.TRACE,r)},o.disableAll=function(r){o.setLevel(o.levels.SILENT,r)},o.rebuild=function(){if(i!==o&&(k=F(i.getLevel())),b.call(o),i===o)for(var r in h)h[r].rebuild()},k=F(i?i.getLevel():"WARN");var G=M();G!=null&&(E=F(G)),b.call(o)}i=new T,i.getLogger=function(c){if(typeof c!="symbol"&&typeof c!="string"||c==="")throw new TypeError("You must supply a name when creating a logger.");var o=h[c];return o||(o=h[c]=new T(c,i.methodFactory)),o};var B=typeof window!==e?window.log:void 0;return i.noConflict=function(){return typeof window!==e&&window.log===i&&(window.log=B),i},i.getLoggers=function(){return h},i.default=i,i})})(O);var Y=O.exports;const u=w(Y),D={level:"info",prefix:"[Backlog Enhancement]",timestamp:!0},m={boardAccordion:"error",issuePending:"error",shortcutKeys:"error",storage:"error",backlog:"error",background:"error",options:"error",content:"error"},_=new Map;function W(n){u.setLevel(n)}function S(n,t){const e=_.get(n);e&&e.setLevel(t),m[n]=t}function z(n){return m[n]||"info"}function j(){return{...m}}function V(n){const t=_.get(n);if(t)return t;const e=u.getLogger(n),d=m[n]||"info";e.setLevel(d);const l=e.methodFactory;return e.methodFactory=function(h,i,L){const I=l(h,i,L);return function(...A){const b=`[${new Date().toISOString()}]`,R=`${D.prefix}`,U=`[${h.toUpperCase()}]`,T=`[${n.charAt(0).toUpperCase()+n.slice(1)}]`,B=[`${b} ${R} ${U} ${T}`,...A].filter(Boolean);I(...B)}},e.setLevel(e.getLevel()),_.set(n,e),e}function K(){if(typeof window>"u"||typeof chrome>"u")return!0;try{return window.location.hostname==="localhost"||window.location.hostname.includes("dev")||chrome.runtime.getManifest().version.includes("dev")}catch{return!0}}function q(n){const t=u.methodFactory;u.methodFactory=function(e,d,l){const h=t(e,d,l);return function(...i){const L=n.timestamp?`[${new Date().toISOString()}]`:"",I=n.prefix?`${n.prefix}`:"",A=`[${e.toUpperCase()}]`,b=[`${L} ${I} ${A}`,...i].filter(Boolean);h(...b)}},u.setLevel(u.getLevel())}function J(n){const t={...D,...n};K()?t.level="debug":t.level="warn",q(t),W(t.level),u.info("Logger initialized",{level:t.level,isDev:K()})}function v(n){const t=V(n);return{debug:(...e)=>t.debug(...e),info:(...e)=>t.info(...e),warn:(...e)=>t.warn(...e),error:(...e)=>t.error(...e)}}const y={debug:(...n)=>u.debug(...n),info:(...n)=>u.info(...n),warn:(...n)=>u.warn(...n),error:(...n)=>u.error(...n),boardAccordion:v("boardAccordion"),issuePending:v("issuePending"),shortcutKeys:v("shortcutKeys"),storage:v("storage"),backlog:v("backlog"),background:v("background"),options:v("options"),content:v("content"),popup:v("popup")},H={setLevel:S,getLevel:z,showAll:()=>{console.table(j())},enable:n=>{S(n,"debug"),console.log(`✅ ${n} logging enabled (debug level)`)},disable:n=>{S(n,"silent"),console.log(`❌ ${n} logging disabled`)},enableAll:()=>{Object.keys(m).forEach(n=>{S(n,"debug")}),console.log("✅ All feature logging enabled")},disableAll:()=>{Object.keys(m).forEach(n=>{S(n,"error")}),console.log("❌ All feature logging disabled (error only)")}};typeof window<"u"&&K()&&(window.__backlogLoggerControl__=H),J();class P{static async getSettings(){try{const e=(await chrome.storage.sync.get(this.SETTINGS_KEY))[this.SETTINGS_KEY];return e?this.mergeWithDefaults(e):g}catch(t){return y.storage.error("Failed to get settings:",t),g}}static async saveSettings(t){try{await chrome.storage.sync.set({[this.SETTINGS_KEY]:t})}catch(e){throw y.storage.error("Failed to save settings:",e),e}}static onSettingsChanged(t){chrome.storage.onChanged.addListener((e,d)=>{if(d==="sync"&&e[this.SETTINGS_KEY]){const l=e[this.SETTINGS_KEY].newValue;l&&t(this.mergeWithDefaults(l))}})}static mergeWithDefaults(t){return{boardAccordion:{...g.boardAccordion,...t.boardAccordion},shortcutKeys:{...g.shortcutKeys,...t.shortcutKeys},issuePending:{...g.issuePending,...t.issuePending}}}}x(P,"SETTINGS_KEY","backlog_usability_enhance_settings");class Q{constructor(){x(this,"settings",g);this.init()}async init(){try{await this.loadSettings(),this.updateUI(),this.setupEventListeners(),y.info("Options page initialized")}catch(t){y.error("Failed to initialize options page:",t)}}async loadSettings(){this.settings=await P.getSettings(),y.debug("Settings loaded:",this.settings)}updateUI(){const t=document.getElementById("boardAccordionEnabled");t&&(t.checked=this.settings.boardAccordion.enabled);const e=document.getElementById("shortcutKeysEnabled");e&&(e.checked=this.settings.shortcutKeys.enabled);const d=document.getElementById("issuePendingEnabled"),l=document.getElementById("issuePendingAutoResolve");d&&(d.checked=this.settings.issuePending.enabled),l&&(l.checked=this.settings.issuePending.autoResolve),this.updateSubSettingsState()}updateSubSettingsState(){const t=document.getElementById("issuePendingEnabled"),e=document.getElementById("issuePendingAutoResolve");t&&e&&(e.disabled=!t.checked,e.parentElement.style.opacity=t.checked?"1":"0.5")}setupEventListeners(){const t=document.getElementById("resetButton");t&&t.addEventListener("click",()=>this.resetSettings()),document.querySelectorAll('input[type="checkbox"]').forEach(d=>{d.addEventListener("change",()=>{this.onSettingChanged(),this.updateSubSettingsState()})})}async onSettingChanged(){this.updateSettingsFromUI(),await this.saveSettingsImmediate()}updateSettingsFromUI(){const t=document.getElementById("boardAccordionEnabled");t&&(this.settings.boardAccordion.enabled=t.checked);const e=document.getElementById("shortcutKeysEnabled");e&&(this.settings.shortcutKeys.enabled=e.checked);const d=document.getElementById("issuePendingEnabled"),l=document.getElementById("issuePendingAutoResolve");d&&(this.settings.issuePending.enabled=d.checked),l&&(this.settings.issuePending.autoResolve=l.checked)}async saveSettingsImmediate(){try{await P.saveSettings(this.settings),y.info("Settings saved immediately:",this.settings)}catch(t){y.error("Failed to save settings immediately:",t)}}async resetSettings(){try{if(!confirm("設定をデフォルトに戻しますか？"))return;this.settings={...g},this.updateUI(),await P.saveSettings(this.settings),y.info("Settings reset to default")}catch(t){y.error("Failed to reset settings:",t)}}}document.addEventListener("DOMContentLoaded",()=>{new Q})})();
